/* @license  AGPL-3.0-or-later*/
"use strict";window.g={},window.g.i=Object.keys(window.SESSION_QUESTIONS).map(function(i){return parseInt(i)}),window.g.o=window.g.i.map(function(i){return window.SESSION_QUESTIONS[i]}).sort(function(i,o){return i-o}),window.g.n=window.g.i.length,window.g.e=null,window.g.t=null,window.g.s=null,window.g.a=null,window.g.d=!1,window.g.w=null,window.g.r=-1!=window.location.search.search(/[\?&]presenter=/),-1!=window.g.o.indexOf(null)?window.g.i=window.g.i.sort(function(i,o){return window.SESSION_QUESTIONS[i]-window.SESSION_QUESTIONS[o]}):window.g.i=window.g.i.sort(function(i,o){return i-o});var r=new showdown.Converter({headerLevelStart:3,simpleLineBreaks:!0,noHeaderId:!0});function t(i){i?window.g.c.addClass("marked"):window.g.c.removeClass("marked")}function d(i,o){if(window.g.l=$('#question-pool [data-question-sequence="'+i+'"]'),window.g.l.length?(o?history.replaceState({url:window.g.l.data("url")},"",window.g.l.data("url")):history.pushState({url:window.g.l.data("url")},"",window.g.l.data("url")),_paq.push(["setCustomUrl",window.location.href])):window.g.l=$('#question-pool [data-url="'+i+'"]'),window.g.l.find(".lazy").each(function(){var o=$(this),i=o.data("src"),n=o.data("img-class"),e=$('<img class="d-none '+n+'" src="'+i+'">');e.on("load",function(){var i=$(this).closest("[data-fancybox]").data("fancybox");o.remove(),$(this).removeClass("d-none"),$('[data-fancybox="'+i+'"]').fancybox({buttons:["zoom","download","close"],beforeShow:function(){$(document).off("keydown keydup")},afterClose:function(){S()}})}),o.after(e)}),window.g.l.length){window.g.l.addClass("show"),$(".question-body").not(window.g.l).removeClass("show"),window.g.u=window.g.l.data("question-sequence"),$("#question-sequence").html(window.g.u);var n=window.g.l.data("list-revision-url");$("#question-pk").html(window.g.l.data("question-pk")).attr("href",n),y();var e=50*Math.floor(window.g.u/50),t=50*(Math.floor(window.g.u/50)+1),s=50*(Math.floor(window.g.u/50)-1),a=e-1;if(t>=window.g.n&&(t=null),s<0&&(s=null),o&&N(e),(o&&t&&window.g.u>=t-10||!o&&t&&window.g.u==t-10)&&N(t),(o&&null!==s&&window.g.u<=10+a||!o&&null!==s&&window.g.u==10+a)&&N(s),window.g.r){window.g.l.data("question-id");var d=window.g.l.find(".presenter-stats").get(0).getContext("2d"),w=[],r={datasets:[{data:[]}],labels:[]};window.g.l.find("tr[data-choice-pk]").each(function(){var i=$(this).data("choice-pk");w.push(i)}),w.sort();for(var c=0;c<w.length;c++){var l=w[c],u=$("#choice-text-"+l).text();r.labels.push(u)}window.g.l.find(".presneter-stat-container").show();var h=new Chart(d,{type:"pie",data:r});window.g.h=h,T()}}else{N(50*Math.floor(i/50),i)}}function a(){var i=$(this).data("action");if(1==window.g.u&&"previous"==i)return $("#question-sequence").addClass("animated flash").css("color","yellow"),void $("#question-sequence").one(window.g.p,function(){$(this).removeClass().css("color","")});if(window.g.u==window.g.n&&"next"==i)return $("#question-total").addClass("animated flash").css("color","yellow"),void $("#question-total").one(window.g.p,function(){$(this).removeClass().css("color","")});if("next"==i)var o=window.g.u+1;else if("previous"==i)o=window.g.u-1;if(window.g.l=$("#question-pool [data-question-sequence="+o+"]"),!window.g.l.length)return _paq.push(["trackEvent","show_session","navigation","navigate-unloaded"]),toastr.warning("You're super fast, "+window.USER_FIRST_NAME+"!  Give us a second to bring question #"+o.toString()+"."),void $("#question-loading").addClass("animated flash").css("color","yellow");$(".check, .answer-correction-notification, .opposing-users, .supporting-users").tooltip("hide"),d(o)}function w(){window.IS_SHARED&&"EXPLAINED"!=!window.SESSION_MODE&&$.ajax({url:Urls["exams:toggle_sharing_results"](),type:"POST",data:{session_pk:window.SESSION_PK},cache:!1,success:function(i){if(i.share_results){var o,n=[];if($(".sharer-name").each(function(){$(this).closest(".shared-session").find(".progress").data("pk")!=window.SESSION_PK&&n.push(this.innerHTML)}),1<n.length){var e=n.pop();o=n.join(", ")+" and "+e}else o=n[0];toastr.success("Sharing the results of this session with "+o+" has been enabled."),_paq.push(["trackEvent","show_session","share-results","enable-sharing"]),$("#share-results").prop("checked",!0)}else toastr.success("Sharing the results of this session has been disabled."),_paq.push(["trackEvent","show_session","share-results","disable-sharing"]),$("#share-results").prop("checked",!1);I(window.SESSION_PK,window.g.a)}})}function c(){$("#mark-icon").hide(),$("#mark-loading").css("display","inline-block"),$.ajax({url:Urls["exams:toggle_marked"](),type:"POST",data:{session_pk:window.SESSION_PK,question_pk:window.g.l.data("question-pk")},cache:!1,success:function(i){var o=window.g.l.data("question-pk"),n=window.g.t.indexOf(o);if(window.g.l.data("is-marked",i.is_marked),t(i.is_marked),i.is_marked?(-1==n&&window.g.t.push(o),_paq.push(["trackEvent","show_session","mark-question","add-mark"])):(-1!=n&&window.g.t.slice(n,1),_paq.push(["trackEvent","show_session","mark-question","remove-mark"])),window.g.d){var e=$('.navigate-row[data-question-sequence="'+window.g.u+'"]');i.is_marked?(e.find("td.is_marked").html(window.g.f),L()&&FontAwesome.dom.i2svg({node:document.getElementById("navigation-table")})):e.find("td.is_marked").html("")}$("#mark-icon").show(),$("#mark-loading").hide()}})}function o(){var i=$(this);if(i.is(":checked")){var o=i.closest(".question-body").find(".question-choice").not(i);i.closest("tr").find(".choice-text.strike").length&&(i.closest("tr").find(".choice-text.strike").removeClass("strike"),x()),o.prop("checked",!1)}else i.prop("checked",!1)}function l(){$(this).contents().unwrap(),x()}function u(){var i=$(this).closest(".selection-hint").data("text");if(3<=i.length){var o=$("<div>").text(i).html(),n=$("<span></span>").addClass("highlight").html(i).prop("outerHTML"),e=window.g.l.find(".question-text");e.html(e.html().replace(o,n)),x(),s()}}function n(i){return 3===(i=i||window.event).which||2===i.button||!1}window.g.c=$("#mark"),window.g.k=$("#submit"),window.g.m=[],window.g.v={},window.g.p="webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend",window.g.$='<i class="far fa-check-square"></i>',window.g.f='<i class="fas fa-flag"></i>',window.g.q='<i class="fas fa-times text-danger mx-1"></i>',window.g.b=null!=navigator.userAgent.match(/iPad/i)||null!=navigator.userAgent.match(/Android/i)&&null==navigator.userAgent.match(/Mobile/i),window.g._=null!=navigator.userAgent.match(/iPhone/i)||null!=navigator.userAgent.match(/Android/i)&&null!=navigator.userAgent.match(/Mobile/i),toastr.options.positionClass="toast-top-left",toastr.options.preventDuplicates=!0;var h={mouse:{},isVisible:!(window.onpopstate=function(i){i.state&&d(i.state.url)})};function e(i,o){var n=h.mouse.top-60,e=h.mouse.left+(o.clientX-h.mouse.left)/2,t="",s=encodeURIComponent(i);if((!window.SESSION_IS_EXAMINABLE||window.g.l.data("was-solved"))&&window.SESSION_IS_EXAMINABLE||(t+='<i class="rounded py-2 fas fa-highlighter highlight-selection"></i>'),i.length<=40&&(t+='<a class="d-inline-block" target="_blank" href="https://duckduckgo.com/?q='+s+'"><i class="rounded py-2 fas fa-globe duckduckgo"></i></a>',t+='<a class="d-inline-block" target="_blank" href="https://en.wikipedia.org/wiki/Special:Search/'+s+'"><i class="rounded py-2 fab fa-wikipedia-w wikipedia"></i></a>'),-1==i.indexOf(" ")&&(t+='<a class="d-inline-block" target="_blank" href="https://en.wiktionary.org/wiki/Special:Search/'+s+'"><i class="rounded py-2 fas fa-language wiktionary"></i></a>'),t.length){var a=$('<p class="selection-hint">'+t+"</p>");a.attr("data-text",i),$("body").append(a),$(".selection-hint").css({position:"absolute",top:n,left:e})}}function s(){$(".selection-hint").remove(),document.getSelection().removeAllRanges()}function p(i,o){var n=$(".question-body tr"+("[data-choice-pk="+o+"]"));n.data("has-correction",!0).attr("data-has-correction","true"),n.find(".check").html('<i class="fas fa-exclamation-triangle text-warning answer-correction-notification mx-1"></i>'+i)}function initializeMnemonicInteractions(){var t=window.g.l.data("question-pk");window.g.l.find(".mnemonic").each(function(){var i=$(this);i.data("submitter-pk")==window.USER_PK&&(i.find(".like-mnemonic").attr("disabled",!0),i.find(".delete-mnemonic").removeClass("d-none"))}),window.g.l.find(".like-mnemonic").off("click").on("click",function(){var i=$(this),o=i.data("action"),n=i.closest(".mnemonic").data("mnemonic-pk"),e=Urls["exams:contribute_mnemonics"]()+"?"+$.param({question_pk:t});$.ajax({url:e,type:"POST",data:{action:o,mnemonic_pk:n},success:function(i){1==i.success?(toastr.success("Your vote was submitted."),window.g.l.find(".mnemonics-content").html(i.mnemonic_html),initializeMnemonicInteractions()):toastr.error(i.message)}})}),window.g.l.off("click",".delete-mnemonic").on("click",".delete-mnemonic",function(){var i=$(this),o=i.data("action"),n=i.closest(".mnemonic").data("mnemonic-pk"),e=Urls["exams:contribute_mnemonics"]()+"?"+$.param({question_pk:t});$.ajax({url:e,type:"POST",data:{action:o,mnemonic_pk:n},success:function(i){1==i.success?(toastr.success("Your mnemonic is deleted."),window.g.l.find(".mnemonics-content").html(i.mnemonic_html),initializeMnemonicInteractions()):toastr.error(i.message)}})})}function f(){window.g.l.off("click",".correct [data-fa-i2svg]").on("click",".correct [data-fa-i2svg]",function(){_paq.push(["trackEvent","show_session","answer_correction","click-correct"]),$("#correct-answer-modal").modal("show");var i=$(this).closest("tr").data("choice-pk"),o=Urls["exams:correct_answer"]()+"?"+$.param({choice_pk:i});$("#correct-answer-modal .modal-body").load(o)})}function k(){var i=window.g.l.find(".explanation-text").length||window.g.l.find(".explanation-figure").length||window.g.l.find(".explanation-reference-header").length,o=window.g.l.data("was-solved"),n=window.g.l.find(".explanation-container");!o||"UNEXPLAINED"==window.SESSION_MODE&&!$("body").data("has-finished")?(n.hide(),$("#explain").hide()):i?(n.show(),$("#explain").show().html('<i class="fas fa-cubes"></i> Improve this explanation!')):(n.hide(),$("#explain").show().html("Add an explanation!"))}function m(){var i=window.g.l.data("was-solved"),o=window.g.l.find(".mnemonic").length;!i||"UNEXPLAINED"==window.SESSION_MODE&&!$("body").data("has-finished")?$(".mnemonics-container, #add-mnemonics").hide():o?($("#add-mnemonics").show().html('<i class="fas fa-book"></i> Add another mnemonic!'),$(".mnemonics-container").show()):($(".mnemonics-container").hide(),$("#add-mnemonics").show().html('<i class="fas fa-book"></i> Add the first mnemonic!'))}function v(){window.g.s&&Object.keys(window.g.s).length>=window.g.n&&$("body").data("has-finished",!0).attr("data-has-finished","true")}function q(){if(!window.g.b){if($("#next").tooltip("dispose"),window.g.u==window.g.n){$("#next").css("cursor","not-allowed");var i=$("#end:visible, #results:visible").html();$("#next").tooltip({title:"This is the last question.  You can click <kbd>"+i+"</kbd> to end this session.",html:!0,sanitize:!1})}else $("#next").tooltip({sanitize:!1}),$("#next").css("cursor","pointer");1==window.g.u?$("#previous").css("cursor","not-allowed"):$("#previous").css("cursor","pointer")}}function b(){var i=$('.navigate-row[data-question-sequence="'+window.g.u+'"]');i.addClass("table-active"),$(".navigate-row").not(i).removeClass("table-active")}function _(){window.g.l.off("click",".highlight"),window.g.l.find(".choice-text").off("click"),window.g.l.find(".question-text").off("mouseup touchend")}function y(){window.g.l.find('[data-toggle="tooltip"]').tooltip(),f(),initializeMnemonicInteractions(),q(),t(window.g.l.data("is-marked")),window.g.d&&b(),$("#contributors").tooltip("dispose"),$("#contributors").off("click").click(function(){_paq.push(["trackEvent","show_session","see-contributors","see-contributors"])}),$("#contributors").tooltip({html:!0,trigger:"click",title:window.g.l.find(".tooltip-body").get(0)}),k(),m();var i=window.g.l.data("was-solved");i?($("#contribute,#add-mnemonics").show(),window.g.k.hide(),window.g.l.find(".question-choice").prop("disabled","disabled")):($("#contribute,#add-mnemonics").hide(),window.g.k.show(),window.g.l.find(".question-choice").off("change").on("change",o)),window.SESSION_IS_EXAMINABLE&&!i||!window.SESSION_IS_EXAMINABLE?window.g.l.find(".choice-text").off("click").on("click",function(){$(this).hasClass("strike")||$(this).closest("tr").find(".question-choice").prop("checked",!1).trigger("change"),$(this).toggleClass("strike"),x()}):_()}function x(){var i=window.g.l.find(".choice-text.strike").map(function(){return $(this).closest("tr").data("choice-pk")}).get();i=JSON.stringify(i);var o={best_revision_pk:window.g.l.data("best-latest-revision-pk"),highlighted_text:window.g.l.find(".question-text").html(),stricken_choice_pks:i,session_pk:window.SESSION_PK,question_pk:window.g.l.data("question-pk")};$.ajax({url:Urls["exams:submit_highlight"](),type:"POST",data:o})}function E(){if($(this).hide(),!window.g.l.data("was-solved")){if(window.g.l.data("was-solved",!0).attr("data-was-solved","true"),window.g.d)$('.navigate-row[data-question-sequence="'+window.g.u+'"]').find("td.was_solved").html(window.g.$),L()&&FontAwesome.dom.i2svg({node:document.getElementById("navigation-table")});window.g.l.find(".question-choice").prop("disabled","disabled"),k(),m(),_(),$("#contribute,#add-mnemonics").show(),window.g.l.find(".question-text, .question-choice, .choice-text").off();var i=window.g.l.find(".question-choice:checked");if(i.length){var o=i.closest("tr"),n=o.data("choice-pk");o.data("is-right")?window.g.a.correct_count+=1:window.g.a.incorrect_count+=1;var e=o.find(".answer-correction-notification"),t=o.find("button.support-correction:enabled");e.length&&t.length&&("UNEXPLAINED"!=window.SESSION_MODE||$("body").data("has-finished"))&&(o.find(".check").tooltip({template:'<div class="tooltip hint" role="tooltip"><div class="arrow"></div><div class="tooltip-inner"></div></div>',html:!0,title:"<strong>Are you sure that this is the right answer?</strong>  Vote to support this correction! <img height='17' src='https://cdnjs.cloudflare.com/ajax/libs/emojione/2.2.7/assets/png/1f64a.png'>",placement:"right",trigger:"manual"}).tooltip("show"),setTimeout(function(){o.find(".check").tooltip("hide")},5e3))}else{window.g.a.skipped_count+=1;n=null}I(window.SESSION_PK,window.g.a);var s=window.g.l.data("question-pk");window.g.s[s]=n,v();var a={session_pk:window.SESSION_PK,question_pk:s,choice_pk:n};$.ajax({url:Urls["exams:submit_answer"](),type:"POST",data:a,cache:!1,success:function(i){i.success?n||toastr.warning("You skipped this question"):toastr.error(i.message)}})}}function U(){var i=$("#container").height()-$("#top-info").height()-$("#top-options").height();$("#question-row").css({"padding-bottom":$("#footer").height(),"min-height":i})}function S(){$(document).keydown(function(i){if(window.g.v[i.which]=!0,window.g.v[37])$("#previous").trigger("click"),_paq.push(["trackEvent","show_session","navigation","keyboard-previous"]);else if(window.g.v[39]||window.g.v[32])i.preventDefault(),$("#next").trigger("click"),_paq.push(["trackEvent","show_session","navigation","keyboard-next"]);else if(window.g.v[18]&&window.g.v[77])_paq.push(["trackEvent","show_session","mark-question","keyboard-mark"]),window.g.c.trigger("click");else if(window.g.v[18]&&window.g.v[85]){if(_paq.push(["trackEvent","show_session","find-pending","keyboard-pending"]),"SOLVED"==window.SESSION_MODE||"INCOMPLETE"==window.SESSION_MODE)return;var o=$(".question-body[data-was-solved=false]").data("question-sequence");o?d(o):toastr.success("Yay!  No pending in this session.")}else if(window.g.v[17]&&window.g.v[13])_paq.push(["trackEvent","show_session","mark-question","keyboard-submit"]),window.g.k.trigger("click");else{if(!(window.g.v[17]&&window.g.v[38]||window.g.v[17]&&window.g.v[40]))return;i.preventDefault();var n=window.g.l.find(".question-choice").length,e=window.g.l.find(".question-choice:enabled:checked");if(e.length){var t=window.g.l.find(".question-choice").index(e);if(window.g.v[38]&&0==t)return;if(window.g.v[40]&&t==n-1)return;if(window.g.v[40]){_paq.push(["trackEvent","show_session","navigation","keyboard-down"]);var s=t+1}else if(window.g.v[38]){_paq.push(["trackEvent","show_session","navigation","keyboard-up"]);s=t-1}}else s=0;var a=window.g.l.find(".question-choice:enabled").get(s);$(a).prop("checked",!0).trigger("change")}}),$(document).keyup(function(i){delete window.g.v[i.which]})}function P(){$("#navigate-modal").modal({show:!1}),$("#open-navigation").off("click").click(function(){_paq.push(["trackEvent","show_session","navigation","open-navigation"]),$("#navigate-modal").modal("show")}),$("#navigate-modal").on("shown.bs.modal",function(){$(this).animate({scrollTop:$(".navigate-row.table-active").position().top},500)});for(var i=document.getElementById("navigation-tbody"),o="",n=1;n<=window.g.i.length;n++){var e=n-1,t=window.g.i[e],s=void 0!==window.g.s[t]?window.g.$:'<i class="far fa-square"></i>';if(window.g.t)var a=-1!=window.g.t.indexOf(t)?window.g.f:"";o+="<tr tabindex='0' class='navigate-row text-center' data-question-sequence='"+n.toString()+"'><td>"+n.toString()+"</td><td class='d-sm-table-cell d-none'>"+t.toString()+"</td><td class='d-sm-table-cell d-none is_marked'>"+a+"</td><td class='was_solved'>"+s+"</td></tr>"}i.innerHTML=o,L()&&FontAwesome.dom.i2svg({node:document.getElementById("navigation-table")}),$("#navigation-table").find(".navigate-row").click(function(){_paq.push(["trackEvent","show_session","navigation","click-navigate-row"]),d($(this).data("question-sequence"))}),b(),window.g.d=!0}function A(){$.ajax({method:"get",url:Urls["answer-list"](),data:{format:"json",session_pk:window.SESSION_PK},success:function(i){window.g.s={},window.g.a={correct_count:0,incorrect_count:0,skipped_count:0},i.map(function(i){null===i.choice?(window.g.a.skipped_count+=1,window.g.s[i.question_id]=null):!0===i.choice.is_right?(window.g.a.correct_count+=1,window.g.s[i.question_id]=i.choice.id):!1===i.choice.is_right&&(window.g.a.incorrect_count+=1,window.g.s[i.question_id]=i.choice.id)}),C($(".question-body")),v(),I(window.SESSION_PK,window.g.a),y(),$("#open-navigation").tooltip("dispose").css("cursor","pointer").click(function(){P(),$(this).trigger("click")})}})}function O(){$.ajax({method:"get",url:Urls["marked-list"](),data:{format:"json",exam_pk:window.EXAM_PK},success:function(i){window.g.t=i.map(function(i){return i.id}),$(".question-body").each(function(){var i=$(this),o=i.data("question-pk");Y(i,o)})}})}function M(){$.ajax({method:"get",url:Urls["highlight-list"](),data:{format:"json",session_pk:window.SESSION_PK},success:function(i){window.g.e={},i.map(function(i){window.g.e[i.revision.question_id]={revision_id:i.revision.id,highlighted_text:i.highlighted_text,stricken_choices:i.stricken_choices}}),$(".question-body").each(function(){j($(this))})}})}function T(){if(window.g.l){if(V(),window.g.r)var i=window.g.l.data("question-pk");else i=null;$.ajax({method:"get",url:Urls["exams:get_shared_session_stats"](),data:{format:"json",session_pk:window.SESSION_PK,question_pk:i},success:function(i){if(i.success){for(var o in i.stats.sessions){var n=i.stats.sessions[o];I(n.pk,n)}window.g.r&&(window.g.h.data.datasets[0].data=i.stats.choices,window.g.h.update()),$('.progress[data-has-finished="false"]').length||V()}else toastr.error(i.message)}}),D()}}function I(i,o){if(window.IS_SHARED){var n=$("#shared-session-"+i),e=n.find(".progress");if(i!=window.SESSION_PK?e.attr("data-has-finished",o.has_finished.toString()):i!=window.SESSION_PK||"EXPLAINED"==window.SESSION_MODE&&$("#share-results").prop("checked")?delete o.count:o.count=o.correct_count+o.incorrect_count+o.skipped_count,n.tooltip("dispose"),o.count){var t=Math.round(o.count/window.g.n*100)+"%";e.html('<div class="progress-bar bg-success" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-valuenow="'+o.count+'" style="width: '+t+'"></div>'),n.tooltip({html:!0,title:'<span class="sharer-name">'+o.count+" out of "+window.g.n+" questions ("+t+")</span>"})}else{var s=Math.round(o.correct_count/window.g.n*100)+"%",a=Math.round(o.incorrect_count/window.g.n*100)+"%",d=Math.round(o.skipped_count/window.g.n*100)+"%";e.html('<div class="progress-bar bg-success" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-valuenow="'+o.correct_count+'" style="width: '+s+'"></div><div class="progress-bar bg-danger" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-valuenow="'+o.incorrect_count+'" style="width: '+a+'"></div><div class="progress-bar bg-warning" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-valuenow="'+o.skipped_count+'" style="width: '+d+'"></div>'),n.tooltip({html:!0,title:'<ul class="mb-0 pl-3 sharer-name"><li>Correct: '+o.correct_count+" ("+s+")</li><li>Incorrect: "+o.incorrect_count+" ("+a+")</li><li>Skipped: "+o.skipped_count+" ("+d+")</li></ul>"})}}}function L(){return(-1!=navigator.userAgent.indexOf("iPhone")||-1!=navigator.userAgent.indexOf("iPad"))&&-1!=navigator.userAgent.indexOf("OS 9_")||-1!=navigator.userAgent.indexOf("Mac OS")&&-1!=navigator.userAgent.indexOf("Version/9")&&-1!=navigator.userAgent.indexOf("Safari/")}function N(e,t){if(-1==window.g.m.indexOf(e)){var s=window.g.i.slice(e,e+50),a=s.join(",");$("#question-loading").show(),$.ajax({method:"get",url:Urls["exams:list_partial_session_questions"](window.CATEGORY_SLUGS,window.EXAM_PK),data:{pks:a},success:function(i){window.g.m.push(e);var o=$(i.html);if(-1!=s.indexOf(window.g.y))var n=o.filter(function(){return $(this).data("question-pk")!=window.g.y});else n=o;C(n),$("#question-pool").append(n),$.ajax({method:"get",url:Urls["correction-list"](),data:{format:"json",exam_pk:window.EXAM_PK,question_pks:a},success:function(i){$.each(i,function(i,o){p(o.html,o.choice_id)})}}),L()&&FontAwesome.dom.i2svg({node:document.getElementById("question-pool")}),t&&d(t),$("#question-loading").hide()}})}}function j(n){if(null!==window.g.e){var i=n.data("question-pk"),e=window.g.e[i];if(void 0!==e)n.data("best-latest-revision-pk")==e.revision_id&&(e.highlighted_text&&n.find(".question-text").html(e.highlighted_text),$.each(e.stricken_choices,function(i){var o=e.stricken_choices[i];n.find("tr[data-choice-pk="+o+"] .choice-text").addClass("strike")}))}}function z(i){if(null!==window.g.s){var o=i.data("question-pk"),n=window.g.s[o];if(void 0!==n){if(i.data("was-solved",!0).attr("data-was-solved","true"),i.find(".question-choice").attr("disabled",!0),n)i.find("tr[data-choice-pk="+n+'] input[type="checkbox"]').prop("checked",!0)}else i.data("was-solved",!1).attr("data-was-solved","false");var e,t,s=i.find(".choice-table tbody"),a=s.find("tr"),d=a.length;for(a.detach();0!==d;)t=Math.floor(Math.random()*d),e=a[d-=1],a[d]=a[t],a[t]=e;s.append(a),s.removeClass("unprepared")}}function Y(i,o){-1!=window.g.t.indexOf(o)?(i.data("is-marked",!0).attr("data-is-marked","true"),i.hasClass("show")&&t(!0)):i.data("is-marked",!1).attr("data-is-marked","false")}function C(i){i.each(function(){var i=$(this),o=i.data("question-pk"),n=i.find(".question-text").html(),e=i.find(".explanation-text").html(),t=r.makeHtml(n);if(i.find(".question-text").html(t),void 0!==e){var s=r.makeHtml(e);i.find(".explanation-text").html(s)}z(i),j(i);var a=window.g.i.indexOf(o)+1;i.data("question-sequence",a).attr("data-question-sequence",a);var d=Urls["exams:list_revisions"](window.CATEGORY_SLUGS,window.EXAM_PK,o),w=Urls["exams:show_session"](window.CATEGORY_SLUGS,window.EXAM_PK,window.SESSION_PK,o);i.data("list-revision-url",d).attr("data-list-revision-url",d),i.data("url",w).attr("data-url",w),"SOLVED"!=window.SESSION_MODE&&"INCOMPLETE"!=window.SESSION_MODE||(i.data("was-solved",!0).attr("data-was-solved","true"),i.find(".question-choice").attr("disabled",!0)),window.g.t&&Y(i,o)});var o=$("#question-pool");o.hasClass("choices-were-animated")||(o.addClass("choices-were-animated"),window.g.l.find("tbody").addClass("animated fadeIn").one(window.g.p,function(){$(this).removeClass()}))}function D(){if(!window.g.w&&document.hasFocus()&&$('.progress[data-has-finished="false"]').length){var i=window.g.r?2e3:5e3;window.g.w=setInterval(T,i)}}function V(){window.g.w&&(clearInterval(window.g.w),window.g.w=null)}$("#question-pool").mousedown(function(i){h.mouse.top=i.clientY+window.pageYOffset,h.mouse.left=i.clientX,!n(i)&&h.isVisible&&(s(),h.isVisible=!1)}),$("#question-pool").mouseup(function(i){var o=window.getSelection().toString().trim();5<o.length&&!n(i)&&(e(o,i),h.isVisible=!0)}),window.g.b&&($(".mobile-slide").removeClass("d-lg-none"),$("#question-col").removeClass("col-lg-12 px-lg-5")),(window.g.b||window.g._)&&$("#keyboard-hint").addClass("d-none"),$(function(){new ClipboardJS("#share-session-copy").on("success",function(i){_paq.push(["trackEvent","show_session","share","click-copy"]),$(i.trigger).tooltip("show"),setTimeout(function(){$(i.trigger).tooltip("hide")},1e3)});var i=$(".question-body.show");window.g.y=i.data("question-pk");var o=window.g.i.indexOf(window.g.y)+1;i.attr("data-question-sequence",o).data("question-sequence",o),d(o,!0),$("#question-total").html(window.g.n),$("#question-sequence").html(o),S(),window.IS_SHARED&&($(window).on("focus",function(){$('.progress[data-has-finished="false"]').length&&T(),D()}),$(window).on("blur",V)),window.g.b?$('[data-toggle="tooltip"]').not("#next, #previous, #mark").tooltip({sanitize:!1}):window.g._?$('[data-toggle="tooltip"]').not(window.g.c).tooltip({sanitize:!1}):$('[data-toggle="tooltip"]').tooltip({sanitize:!1});var n=$("#help-me-tooltip").get(0);$("#help-me").tooltip({html:!0,trigger:"click",title:n}),$("#help-me").click(function(){_paq.push(["trackEvent","show_session","click-get-help","click-get-help"])});var e=$("#setting-tooltip").get(0);$("#settings").tooltip({html:!0,placement:"bottom",trigger:"click",title:e}),$("#settings").click(function(){_paq.push(["trackEvent","show_session","click-settings","click-settings"])});var t=$("#share-tooltip").get(0);$("#share").tooltip({html:!0,trigger:"click",title:t}),$("#share").click(function(){$(this).removeClass("emphasized"),_paq.push(["trackEvent","show_session","share","click-share"])}),$("#theme-select").change(function(){var i=$(this).find("option:selected");$(":root").css({"--primary-background-color":i.data("primary-background-color"),"--secondary-background-color":i.data("secondary-background-color"),"--tertiary-background-color":i.data("tertiary-background-color"),"--primary-font-color":i.data("primary-font-color"),"--secondary-font-color":i.data("secondary-font-color"),"--tertiary-font-color":i.data("tertiary-font-color"),"--highlight-background":i.data("highlight-background"),"--highlight-color":i.data("highlight-color"),"--table-active":i.data("table-active"),"--table-hover":i.data("table-hover")})}),$("#save-theme").click(function(){$.ajax({url:Urls["exams:update_session_theme"](),type:"POST",data:{session_theme_pk:$("#theme-select").val()},success:function(i){i.success?($("#settings").tooltip("hide"),toastr.success("Your theme was updated!")):toastr.error(i.message)}})}),A(),M(),O(),U(),$(window).resize(U),window.IS_SHARED&&(T(),D(),$("#share-results").change(w)),$(".mobile-slide").click(function(){$(this).hasClass("previous")?($("#previous").trigger("click"),_paq.push(["trackEvent","show_session","navigation","slide-previous"])):$(this).hasClass("next")&&($("#next").trigger("click"),_paq.push(["trackEvent","show_session","navigation","slide-next"]))}),$("#end").click(function(){$("#confirm-end-modal a.submit-button").prop("href",Urls["exams:show_session_results"](window.CATEGORY_SLUGS,window.EXAM_PK,window.SESSION_PK)),$("#confirm-end-modal").modal("show")}),window.g.k.click(E),$("#previous, #next").click(a),window.g.c.click(c),$(document).on("click",".wikipedia, .duckduckgo, .wiktionary",function(){var i=$(this).closest(".selection-hint").data("text"),o=$(this).hasClass("wikipedia")?"wikipedia":$(this).hasClass("duckduckgo")?"duckduckgo":"wiktionary";_paq.push(["trackEvent","show_session",o,i])}),$(document).on("click",".highlight-selection",u),$(document).on("click",".highlight",l),$(document).tooltip({selector:".answer-correction-notification",html:!0,trigger:"click",title:function(){var i=$(this).closest("td").find(".answer-correction-tooltip-body").clone(!0);return i.find('[data-toggle="tooltip"]').tooltip(),i.get(0)}}),$(document).on("show.bs.tooltip",".answer-correction-notification",function(){$(".answer-correction-notification").not(this).tooltip("hide"),_paq.push(["trackEvent","show_session","answer_correction","click-notification"])}),$(document).on("click",".delete-correction",function(){var o=$(this).data("choice-pk"),i=Urls["exams:delete_correction"]()+"?"+$.param({choice_pk:o}),n="[data-choice-pk="+o+"]",e=window.g.l.find("tr"+n);e.data("has-correction",!1).attr("data-has-correction","false"),$(".answer-correction-notification").tooltip("hide"),$(this).tooltip("hide"),$.ajax({url:i,type:"POST",success:function(i){1==i.success?(toastr.success("Your correction was removed."),i.correction_html?p(i.correction_html,o):e.find(".check").html(window.g.q)):toastr.error(i.message)}})}),$(document).on("click",".support-correction, .oppose-correction",function(){var i=$(this).data("action"),o=$(this).data("choice-pk"),n=Urls["exams:correct_answer"]()+"?"+$.param({choice_pk:o});_paq.push(["trackEvent","show_session","answer_correction","delete-notification"]),$.ajax({url:n,type:"POST",data:{action:i},success:function(i){1==i.success?(toastr.success("Your vote was submitted."),p(i.correction_html,o)):toastr.error(i.message)}})}),$("#modify-question-modal, #explain-question-modal,#add-mnemonics-modal").modal({keyboard:!1,backdrop:"static",show:!1}),$("#contribute").click(function(){$("#modify-question-modal").modal("show");var i=Urls["exams:contribute_revision"]()+"?"+$.param({question_pk:window.g.l.data("question-pk")});$("#modify-question-modal .modal-body").load(i)}),$("#explain, a.explain").click(function(){$("#explain-question-modal").modal("show");var i=Urls["exams:contribute_explanation"]()+"?"+$.param({question_pk:window.g.l.data("question-pk")});$("#explain-question-modal .modal-body").load(i)}),$("#add-mnemonics").click(function(){$("#add-mnemonics-modal").modal("show");var i=Urls["exams:contribute_mnemonics"]()+"?"+$.param({question_pk:window.g.l.data("question-pk")});$("#add-mnemonics-modal .modal-body").load(i)});var s="#explain-question-modal,#modify-question-modal,#correct-answer-modal,#add-mnemonics-modal";$(s).on("hidden.bs.modal",function(){S()}),$(s).on("show.bs.modal",function(){$(document).off("keydown keydup")})});
//# sourceMappingURL=show_session.min.js.map
