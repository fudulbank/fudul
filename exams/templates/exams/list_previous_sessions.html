{% extends 'base_new.html' %}{% load exam_utils staticfiles bootstrap3 %}

{% block title %}Fudul | Previous sessions {% endblock %}

{% block head %}
<style>
tr td:last-child{
  text-align: center;
}
</style>

<link rel="stylesheet" type="text/css" href="{% static 'stack/vendors/css/tables/datatable/dataTables.bootstrap4.min.css' %}">
{% endblock %}

{% block header_title %}
<h1>Previous sessions</h1>
{% endblock %}

{% block breadcrumb %}
      <li class="breadcrumb-item"><a href="{% url 'index' %}">Home page</a></li>
      <li class="breadcrumb-item"><a href="{% url 'exams:list_meta_categories' %}">Exams</a></li>
      <li class="breadcrumb-item active">Previous sessions</li>
{% endblock %}

{% block content %}
<div class="card">
  <div class="card-body">
    <div class="card-block">
       <table class="table table-striped table-bordered datatable dt-responsive">
          <thead>
            <tr>
              <th data-priority="6">ID</th>
              <th data-priority="1">Exam</th>
              <th data-priority="4"># questions</th>
              <th data-priority="4">Subjects</th>
              <th data-priority="5">Mode</th>
              <th data-priority="2">Score</th>
              <th data-priority="3">Action</th>
            </tr>
          </thead>
          <tbody>
          {% for session in sesstions %}
          <tr>
              <td>{{ session.pk }}</td>
              <td><a href="{% url 'exams:create_session' session.exam.category.get_slugs session.exam.pk %}">{{ session.exam.name }}</a></td>
              <td>{{ session.questions.approved.count }}</td>
              <td>
          {% if session.subjects.count == 1 %}
              {{ session.subjects.first.name }}
          {% elif not session.exam.subject_set.exists %}
              <span data-toggle="tooltip" title="{{ session.exam.name }} has no sub-subjects">N/A</span>
          {% else %}
              <span data-toggle="tooltip" data-html="true" title="<ul>{% for subject in session|get_session_subjects %}<li>{{ subject.name }}</li>{% endfor %}</ul>">Multiple</span>
          {% endif %}
              </td>
              <td>{{ session.get_session_mode_display }}</td>
          {% if session.session_mode == 'SOLVED' %}
              <td>N/A</td>
          {% elif session.has_finished %}
              <td>{{ session.get_score }}%</td>
          {% else %}
              <td><span data-toggle="tooltip" title="{{ session.get_unused_questions.count }} out of {{ session.questions.approved.count}} remaining">Ongoing</span></td>
          {% endif %}
              <td>
          {% if session.session_mode != 'SOLVED' and not session.has_finished %}
                  <a class="btn btn-sm btn-primary" href="{% url 'exams:show_session' session.exam.category.get_slugs session.exam.pk session.pk %}"><i class="ft-play"></i> Resume</a>
          {% else %}
                  <a class="btn btn-sm btn-primary" href="{% url 'exams:show_session_results' session.exam.category.get_slugs session.exam.pk session.pk %}"><i class="ft-list"></i> View results</a>
          {% endif %}
              </td>
            </tr>

          {% endfor %}
          </tbody>
        </table>
    </div><!--card-block-->
  </div><!--card-body-->
</div><!--card-->

{% endblock %}
{% block customscript %}
<script src="{% static 'stack/vendors/js/tables/jquery.dataTables.min.js' %}" type="text/javascript"></script>
<script src="{% static 'stack/vendors/js/tables/datatable/dataTables.bootstrap4.min.js' %}" type="text/javascript"></script>
<script src="{% static 'stack/vendors/js/tables/datatable/dataTables.responsive.min.js' %}" type="text/javascript"></script>

    <script>
    $(function () {
        $('[data-toggle="tooltip"]').tooltip()
        $(".datatable").DataTable({
            "order": [[ 2, "desc" ]]
        });
    });
    </script>
{% endblock %}
