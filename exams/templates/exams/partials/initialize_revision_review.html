{% with modal_id='confirm-delete-revision-modal' is_small=True modal_title="Remove revision" modal_content="Are you sure you want to remove the submitted revision?" %}{% load static %}
    {% include "exams/modals/common_edit_modal.html" %}
{% endwith %}

<script src="{% static 'js/toastr.js' %}"></script>
<script type="text/javascript">
toastr.options.positionClass = "toast-top-left";
$(function(){
    $confirmRevisionDeletion = $("#confirm-delete-revision-modal .submit-button")
    $('.confirm-delete-revision').click(function () {
        var url = $(this).data('url');
        var pk = $(this).data('pk');
        $confirmRevisionDeletion.data('url', url).data('pk', pk);
        $("#confirm-delete-revision-modal").modal('show');
    });
    $confirmRevisionDeletion.click(function () {
        /* get some values from elements on the page: */
        var url = $(this).data('url');
				var pk = $(this).data('pk');
        /* Send the data using post */
        var posting = $.post(url);
        posting.done(function (data) {
            if (data.success == 1) {
                // show success message (using toastr)
                row = $revision_table.row("tr[data-revision_pk=" +  pk + "]");
                row.remove().draw(false);
                toastr.info("Revision was successfully deleted.");
    						$("#confirm-delete-revision-modal, #show-revision-modal").modal('hide');
            } else {
                toastr.error(data.message);
            }
        });
    });
    $(".approve-revision").click(function () {
        /* get some values from elements on the page: */
        $this = $(this);
        var url = $(this).data('url');
				var pk = $(this).data('pk');
        /* Send the data using post */
        var posting = $.post(url);
        posting.done(function (data) {
            if (data.success == 1) {
                status_cell = $revision_table.cell(".status").node();
                $status_cell = $(status_cell);
                $status_cell.removeClass("text-danger")
                            .addClass("text-success")
                            .html("Yes");
                $this.hide();
                $this.closest('.btn-group').find(".pend-revision").show();
                //row.remove().draw(false);
                toastr.info("Revision is now approved");
                $("#show-revision-modal").modal('hide');
                $("#confirm-delete-revision-modal").modal('hide');
            } else {
                toastr.error(data.message);
            }
        });
    });
    $(".pend-revision").click(function () {
        /* get some values from elements on the page: */
        $this = $(this);
        var url = $(this).data('url');
				var pk = $(this).data('pk');
        /* Send the data using post */
        var posting = $.post(url);
        posting.done(function (data) {
            if (data.success == 1) {
                status_cell = $revision_table.cell(".status").node();
                $status_cell = $(status_cell);
                $status_cell.removeClass("text-success")
                            .addClass("text-danger")
                            .html("No");
                $this.hide();
                $this.closest('.btn-group').find(".approve-revision").show();
                //row.remove().draw(false);
                toastr.info("Revision is now approved");
                $("#show-revision-modal").modal('hide');
                $("#confirm-delete-revision-modal").modal('hide');
            } else {
                toastr.error(data.message);
            }
        });
    });
});
</script>
